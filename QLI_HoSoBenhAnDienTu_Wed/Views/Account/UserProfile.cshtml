@model QLI_HoSoBenhAnDienTu_Wed.Models.viewsmodel.UserProfileViewModel
@{
    ViewBag.Title = "Hồ sơ cá nhân";
    Layout = "~/Views/Shared/_Layout.cshtml";

    string avatarPath = string.IsNullOrEmpty(Model.AnhDaiDien)
        ? "/Content/Images/default-user.png"
        : "/Content/Images/Avatars/" + Model.AnhDaiDien;
}

<div class="container py-5">
    <div class="row">
        <div class="col-md-4 mb-4">
            <div class="card shadow border-0 text-center p-4">
                <div class="mb-3 position-relative d-inline-block mx-auto">
                    <img src="@avatarPath" class="rounded-circle img-thumbnail shadow-sm"
                         style="width: 150px; height: 150px; object-fit: cover;" id="imgPreview">

                    <label for="uploadAnh" class="btn btn-sm btn-primary position-absolute bottom-0 end-0 rounded-circle"
                           title="Đổi ảnh" style="width: 35px; height: 35px;">
                        <i class="fa-solid fa-camera"></i>
                    </label>
                </div>
                <h4>@Model.HoTen</h4>
                <p class="text-muted mb-1">@Model.TenVaiTro</p>
                <p class="text-muted font-size-sm">@Model.TenDangNhap</p>
            </div>
        </div>

        <div class="col-md-8">
            <div class="card shadow border-0">
                <div class="card-header bg-white border-bottom-0 pt-4 px-4">
                    <h5 class="mb-0 text-primary"><i class="fa-solid fa-user-pen"></i> Cập nhật thông tin</h5>
                </div>
                <div class="card-body px-4 pb-4">

                    @using (Html.BeginForm("UpdateProfile", "Account", FormMethod.Post, new { enctype = "multipart/form-data" }))
                    {
                        @Html.AntiForgeryToken()
                        @Html.HiddenFor(m => m.MaTaiKhoan)

                        <input type="file" name="uploadAnh" id="uploadAnh" style="display:none;" accept="image/*" onchange="previewImage(this)">

                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label class="form-label fw-bold">Họ và tên</label>
                                @Html.TextBoxFor(m => m.HoTen, new { @class = "form-control" })
                                @Html.ValidationMessageFor(m => m.HoTen, "", new { @class = "text-danger" })
                            </div>
                            <div class="col-md-6">
                                <label class="form-label fw-bold">Số điện thoại</label>
                                @Html.TextBoxFor(m => m.SDT, new { @class = "form-control" })
                                @Html.ValidationMessageFor(m => m.SDT, "", new { @class = "text-danger" })
                            </div>
                        </div>

                        <div class="mb-3">
                            <label class="form-label fw-bold">Email</label>
                            @Html.TextBoxFor(m => m.Email, new { @class = "form-control" })
                            @Html.ValidationMessageFor(m => m.Email, "", new { @class = "text-danger" })
                        </div>

                        if (Model.TenVaiTro == "BENH_NHAN")
                        {
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <label class="form-label fw-bold">Ngày sinh</label>
                                    <input type="date" name="NgaySinh" class="form-control"
                                           value="@(Model.NgaySinh.HasValue ? Model.NgaySinh.Value.ToString("yyyy-MM-dd") : "")">
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label fw-bold">Giới tính</label>
                                    <select name="GioiTinh" class="form-select">
                                        <option value="M" @(Model.GioiTinh == "M" ? "selected" : "")>Nam</option>
                                        <option value="F" @(Model.GioiTinh == "F" ? "selected" : "")>Nữ</option>
                                    </select>
                                </div>
                            </div>
                            <div class="mb-3">
                                <label class="form-label fw-bold">Địa chỉ</label>
                                @Html.TextAreaFor(m => m.DiaChi, new { @class = "form-control", rows = 2 })
                            </div>
                        }

                        if (Model.TenVaiTro == "BAC_SI")
                        {
                            <div class="mb-3">
                                <label class="form-label fw-bold">Giới thiệu bản thân (Kinh nghiệm, chuyên môn)</label>
                                @Html.TextAreaFor(m => m.GioiThieu, new { @class = "form-control", rows = 4 })
                            </div>
                        }

                        <div class="text-end mt-4">
                            <button type="submit" class="btn btn-primary px-4">
                                <i class="fa-solid fa-save"></i> Lưu thay đổi
                            </button>
                        </div>
                    }
                </div>
            </div>
        </div>
    </div>
</div>

@section scripts {
    <script>
    // Hàm xem trước ảnh khi chọn file
    function previewImage(input) {
        if (input.files && input.files[0]) {
            var reader = new FileReader();
            reader.onload = function (e) {
                $('#imgPreview').attr('src', e.target.result);
            }
            reader.readAsDataURL(input.files[0]);
        }
    }
    </script>
}